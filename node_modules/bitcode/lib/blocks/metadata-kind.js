"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const buffer_1 = require("buffer");
const bitstream_1 = require("../bitstream");
const constants_1 = require("../constants");
const base_1 = require("./base");
const METADATA_KIND_ABBR_ID_WIDTH = 3;
class MetadataKindBlock extends base_1.Block {
    constructor(map) {
        super();
        this.map = map;
    }
    build(writer) {
        super.build(writer);
        // No metadata to write
        if (this.map.size === 0) {
            return;
        }
        writer.enterBlock(constants_1.BLOCK_ID.METADATA_KIND, METADATA_KIND_ABBR_ID_WIDTH);
        writer.defineAbbr(new bitstream_1.Abbr('kind', [
            bitstream_1.Abbr.literal(constants_1.METADATA_KIND_CODE.KIND),
            bitstream_1.Abbr.vbr(constants_1.VBR.METADATA_KIND_INDEX),
            bitstream_1.Abbr.blob(),
        ]));
        for (const [key, value] of this.map) {
            const buf = buffer_1.Buffer.from(key);
            writer.writeRecord('kind', [value, buf]);
        }
        writer.endBlock(constants_1.BLOCK_ID.METADATA_KIND);
    }
}
exports.MetadataKindBlock = MetadataKindBlock;
//# sourceMappingURL=metadata-kind.js.map